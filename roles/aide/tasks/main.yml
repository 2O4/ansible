- name: Install aide
  ansible.builtin.package:
    name: aide
    state: latest

- name: Remove aide rules
  ansible.builtin.file:
    path: "/etc/aide/aide.conf.d/{{ item }}"
    state: absent
  loop: "{{ aide_remove_rules }}"

- name: Initialize aide
  ansible.builtin.command:
    cmd: aideinit
    creates: /var/lib/aide/aide.db.new
  notify:
    - Copy new aide database

- name: Schedule aide check
  ansible.builtin.cron:
    name: aide check
    job: aide --check --config /etc/aide/aide.conf
    special_time: daily
