#- name: Restrict permissions for sudo executable
#  ansible.builtin.file:
#    path: /usr/bin/sudo
#    owner: root
#    group: sudo
#    mode: u=rws,g=rx,o-rwx

- name: Update sudoers file
  ansible.builtin.template:
    src: sudoers.j2
    dest: /etc/sudoers
    owner: root
    group: root
    mode: 0440
    backup: true

- name: Ensure group sudo exists
  ansible.builtin.group:
    name: sudo
    state: present

# TODO make a list of sudo users
- name: Add users to sudo group
  ansible.builtin.user:
    name: "{{ item.name }}"
    groups: sudo
    append: yes
  with_items: "{{ users }}"
  when: users
